<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel Reselling ‚Äì Gesti√≥n de Facturas</title>

<style>
body{
  font-family: "Segoe UI", sans-serif;
  padding:20px;
  background:#0a0a0a;
  color:#e6e6e6;
}

header{
    display:flex;
    align-items:center;
    gap:15px;
    margin-bottom:12px;
}

header img{
    height:42px;
}

h2{
  font-size:22px;
  font-weight:700;
  color:#00E0FF;
}

/* ==================== FILTROS DARK ==================== */
.controls{
  margin-bottom:18px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.controls select,.controls input{
  padding:8px 10px;
  border-radius:5px;
  border:1px solid #444;
  background:#111;
  color:white;
}
.controls button{
  background:#00b7ff;
  color:black;
  font-weight:600;
  border:none;
  padding:8px 14px;
  border-radius:5px;
  cursor:pointer;
}
.controls button:hover{background:#00d5ff}

/* ==================== TABLA ==================== */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
  background:#111;
  border-radius:6px;
  overflow:hidden;
}
th{
  background:#00B7FF;
  color:black;
  padding:10px;
  font-size:14px;
  font-weight:bold;
}
td{
  padding:8px;
  border:1px solid #181818;
  text-align:center;
}

/* ==================== SEM√ÅFOROS DARK ==================== */
.badge{
  padding:6px 12px;
  border-radius:10px;
  font-weight:bold;
  font-size:12px;
  display:inline-block;
}
.ok{
  background:linear-gradient(135deg,#00ff88,#00c26a);
  color:black;
  box-shadow:0 0 8px rgba(0,255,135,.45);
}
.pendiente{
  background:linear-gradient(135deg,#ff4646,#b30000);
  color:white;
  box-shadow:0 0 6px rgba(255,70,70,.35);
}

/* ==================== SECCI√ìN BAJA ==================== */
.bottom-controls{
  margin-top:20px;
  display:flex;
  gap:12px;
}
</style>
</head>
<body>

<header>
    <img src="https://zentagroup.com/wp-content/uploads/2024/03/cropped-zenta-logo-azul-300x300.png">
    <h2>Panel Reselling ‚Äì Gesti√≥n de Facturaci√≥n</h2>
</header>

<!-- ======================= FILTROS ======================= -->
<div class="controls">
  <select id="filterCliente"><option value="">Todos los clientes</option></select>
  <input type="month" id="filterPeriodo">
  <button onclick="filtrar()">Filtrar</button>
  <button onclick="limpiarFiltros()">Restablecer</button>
  <button onclick="enviarMasivo()">üì© Enviar masivo (doble verde)</button>
</div>

<!-- ======================= TABLA ======================= -->
<table>
<thead>
<tr>
<th>Cliente</th>
<th>Periodo</th>
<th>Monto Consumo Google (USD)</th>
<th>Costo Consumo (USD)</th>
<th>Utilidad (%)</th>
<th>Factura Emitida</th>
<th>Inf. Google</th>
<th>Enviar Correo</th>
</tr>
</thead>
<tbody id="tablaFacturas"></tbody>
</table>

<!-- ======================= INFORME FINANZAS ======================= -->
<div class="bottom-controls">
  <label>Informe Finanzas:
    <select id="selectClienteInforme"><option value="">Seleccionar</option></select>
  </label>
  <button onclick="generarInforme()">üìÑ Generar Informe</button>
</div>

<script>
/* ========== DATOS GENERADOS ========== */
const clientes=["Microsoft","CMPC","Oracle","Google","Apple","BancoEstado","Entel","Codelco","LATAM","Scotiabank","Claro","Banco de Chile"];
const facturas=[];

function rnd(min,max){return Math.floor(Math.random()*(max-min+1))+min;}

for(let i=0;i<100;i++){
  let c=clientes[rnd(0,clientes.length-1)];
  let y=2025; let m=rnd(1,12); m=m<10?"0"+m:m;
  let consumo=rnd(5000,60000);
  let costo=rnd(3000,consumo-1000);
  let utilidad=((consumo-costo)/consumo*100).toFixed(2); // ‚Üê CALCULO REAL

  facturas.push({
    cliente:c, periodo:`${y}-${m}`,
    consumo,costo, utilidad,
    factura:Math.random()<0.78,
    informe:Math.random()<0.70
  });
}

/* ========== Carga selectores ========== */
function initSelects(){
  const s=new Set();
  facturas.forEach(f=>{
    if(!s.has(f.cliente)){
      s.add(f.cliente);
      filterCliente.innerHTML+=`<option>${f.cliente}</option>`;
      selectClienteInforme.innerHTML+=`<option>${f.cliente}</option>`;
    }
  });
}

/* ========== Render Tabla ========== */
function render(data){
 let html="";
 data.forEach(f=>{
 let enviar = (f.factura && f.informe) ? `<button style="background:#00ff9d;border:none;padding:5px 10px;border-radius:4px;cursor:pointer;">Enviar</button>`:"‚Äî";
 html+=`
<tr>
<td>${f.cliente}</td>
<td>${f.periodo}</td>
<td>$${f.consumo.toLocaleString()}</td>
<td>$${f.costo.toLocaleString()}</td>
<td>${f.utilidad}%</td>

<td><span class="badge ${f.factura?'ok':'pendiente'}">${f.factura?'OK':'No emitida'}</span></td>
<td><span class="badge ${f.informe?'ok':'pendiente'}">${f.informe?'OK':'Pendiente'}</span></td>
<td>${enviar}</td>
</tr>`;
 });
 tablaFacturas.innerHTML=html;
}

/* ========== Filtros ========== */
function filtrar(){
 let c=filterCliente.value, p=filterPeriodo.value;
 render(facturas.filter(f=>(!c||f.cliente===c)&&(!p||f.periodo===p)));
}
function limpiarFiltros(){filterCliente.value="";filterPeriodo.value="";render(facturas);}

/* ========== Env√≠o masivo Solo verde/verde ========== */
function enviarMasivo(){
 let x=facturas.filter(f=>f.factura&&f.informe);
 if(!x.length) return alert("No hay clientes doble verde.");
 alert("Se enviar√≠an correos a:\n"+x.map(f=>`${f.cliente} - ${f.periodo}`).join("\n"));
}

/* ========== Informe Finanzas ========== */
function generarInforme(){
 let c=selectClienteInforme.value;
 if(!c)return alert("Selecciona cliente");
 let d=facturas.filter(f=>f.cliente===c);
 let consumo=d.reduce((a,b)=>a+b.consumo,0);
 let costo=d.reduce((a,b)=>a+b.costo,0);
 let util=((consumo-costo)/consumo*100).toFixed(2);
 alert(`üìÑ Informe Finanzas Zenta\nCliente: ${c}\nConsumo total: $${consumo.toLocaleString()}\nCosto total: $${costo.toLocaleString()}\nUtilidad Total: ${util}%`);
}

window.onload=()=>{initSelects();render(facturas);}
</script>
</body>
</html>
