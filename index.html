<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel Reselling â€“ GestiÃ³n de FacturaciÃ³n</title>

<style>
  body {font-family: Arial, sans-serif; background:#f8f9fa; padding:20px;}
  h2{color:#1a3d7c;}

  .controls{
    margin-bottom:20px;display:flex;flex-wrap:wrap;gap:10px;align-items:center;
  }
  .controls select,.controls input{padding:6px 10px;font-size:14px;}
  .controls button{
    padding:8px 14px;background:#1a3d7c;color:#fff;border:none;border-radius:4px;cursor:pointer;
  }
  .controls button:hover{background:#16345d;}

  table{width:100%;border-collapse:collapse;margin-top:10px;}
  th,td{border:1px solid #ccc;padding:8px;text-align:center;}
  th{background:#1a3d7c;color:white;}

  /* Nuevos semÃ¡foros mejorados */
  .semaforo{
      padding:6px 14px;border-radius:50px;font-size:13px;font-weight:600;color:#fff;
      display:inline-block;min-width:70px;transition:.25s;
  }
  .ok{
      background:linear-gradient(135deg,#3bd57f,#10a85f);
      box-shadow:0px 0px 6px rgba(0,209,115,.45);
  }
  .ok:hover{
      transform:scale(1.07);
      box-shadow:0px 0px 12px rgba(0,209,115,.75);
  }
  .pendiente{
      background:linear-gradient(135deg,#ff4f4f,#d63131);
      box-shadow:0px 0px 6px rgba(255,82,82,.45);
  }
  .pendiente:hover{
      transform:scale(1.07);
      box-shadow:0px 0px 12px rgba(255,82,82,.75);
  }

  /* BotÃ³n enviar correo individual */
  .btn-mail{
      background:#1a3d7c;color:white;border:none;padding:5px 10px;border-radius:6px;
      cursor:pointer;font-size:12px;transition:.2s;
  }
  .btn-mail:hover{background:#142b57;transform:scale(1.05);}

  .bottom-controls{margin-top:20px;display:flex;gap:12px;}
</style>
</head>
<body>

<h2>ðŸ“Š Panel Reselling â€“ GestiÃ³n de FacturaciÃ³n</h2>

<div class="controls">
  <label>Filtrar cliente:
    <select id="filterCliente"><option value="">Todos</option></select>
  </label>
  <label>Filtrar periodo:
    <input type="month" id="filterPeriodo" />
  </label>
  <button onclick="filtrar()">Aplicar filtros</button>
  <button onclick="limpiarFiltros()">Limpiar filtros</button>
  <button onclick="enviarMasivo()">ðŸ“¤ Enviar correos masivos</button>
</div>

<table>
<thead>
<tr>
  <th>Cliente</th>
  <th>Periodo</th>
  <th>Monto consumo Google (USD)</th>
  <th>Costo Consumo (USD)</th>
  <th>Utilidad Zenta (USD)</th>
  <th>Factura Emitida</th>
  <th>Informe Google Generado</th>
  <th>Enviar correo</th> <!-- ðŸ“© Nueva columna -->
</tr>
</thead>
<tbody id="tablaFacturas"></tbody>
</table>

<div class="bottom-controls">
  <label>Cliente para informe finanzas:
    <select id="selectClienteInforme">
      <option value="">Seleccionar cliente</option>
    </select>
  </label>
  <button onclick="generarInforme()">ðŸ“„ Generar Informe Finanzas</button>
</div>

<script>
/* ---------------- Datos simulados 100 registros ---------------- */
const clientes=["Microsoft","CMPC","Oracle","Google","Apple","BancoEstado","Entel","Codelco","Falabella","Sodimac","LATAM","Scotiabank","Claro","Ripley","Banco de Chile"];
const facturas=[];
function randomBetween(a,b){return Math.floor(Math.random()*(b-a+1))+a;}

for(let i=0;i<100;i++){
 let cliente=clientes[randomBetween(0,clientes.length-1)];
 let year=2023+randomBetween(0,2);
 let m=randomBetween(1,12);
 let mes=m<10?"0"+m:m;
 let periodo=`${year}-${mes}`;
 let monto=randomBetween(5000,50000);
 let costo=Math.floor(monto*(randomBetween(50,90)/100));
 let utilidad=monto-costo;
 let factura=Math.random()<0.8;
 let infGen=Math.random()<0.7;

 facturas.push({cliente,periodo,monto,costo,utilidad,factura,infGen,email:cliente.toLowerCase()+"@mail.com"});
}

/* ---------------- Render tabla con botÃ³n solo si ambos verdes ---------------- */
function renderTabla(data){
 let html="";
 data.forEach((f,i)=>{

 let puedeEnviar=(f.factura && f.infGen); // Solo si 2 semÃ¡foros verdes
 let boton=puedeEnviar?`<button class="btn-mail">ðŸ“© Enviar</button>`:"";

 html+=`
  <tr>
    <td>${f.cliente}</td>
    <td>${f.periodo}</td>
    <td>$${f.monto.toLocaleString()}</td>
    <td>$${f.costo.toLocaleString()}</td>
    <td>$${f.utilidad.toLocaleString()}</td>

    <td>
      <span class="semaforo ${f.factura?'ok':'pendiente'}">${f.factura?'OK':'Pendiente'}</span>
      ${f.factura?`<a href="docs/factura_${i}.pdf" target="_blank">ðŸ“„</a>`:""}
    </td>

    <td>
      <span class="semaforo ${f.infGen?'ok':'pendiente'}">${f.infGen?'OK':'Pendiente'}</span>
      ${f.infGen?`<a href="docs/informe_${i}.pdf" target="_blank">ðŸ“„</a>`:""}
    </td>

    <td>${boton}</td>
  </tr>`;
 });
 document.getElementById("tablaFacturas").innerHTML=html;
}

/* ---------------- Filtros ---------------- */
function filtrar(){
 let c=document.getElementById("filterCliente").value;
 let p=document.getElementById("filterPeriodo").value;
 let r=facturas;
 if(c) r=r.filter(f=>f.cliente===c);
 if(p) r=r.filter(f=>f.periodo===p);
 renderTabla(r);
}
function limpiarFiltros(){
 document.getElementById("filterCliente").value="";
 document.getElementById("filterPeriodo").value="";
 renderTabla(facturas);
}

/* ---------------- Masivo ---------------- */
function enviarMasivo(){
 let ok=facturas.filter(f=>f.factura && f.infGen);
 if(!ok.length) return alert("No hay casos con ambos OK.");
 let txt="Se enviarÃ¡n correos a:\n\n";
 ok.forEach(f=>txt+=`${f.cliente} - ${f.periodo}\n`);
 alert(txt);
}

/* ---------------- Informe Finanzas ---------------- */
function generarInforme(){
 let c=document.getElementById("selectClienteInforme").value;
 if(!c) return alert("Seleccione cliente.");
 let data=facturas.filter(f=>f.cliente===c);

 let consumo = data.reduce((t,x)=>t+x.monto,0);
 let costo   = data.reduce((t,x)=>t+x.costo,0);
 let utilidad= data.reduce((t,x)=>t+x.utilidad,0);
 let pct=(utilidad/consumo*100).toFixed(2);

 alert(
   `ðŸ“„ Informe Finanzas â€” ${c}\n\n`+
   `Consumo total Google: USD ${consumo}\n`+
   `Costo total Zenta: USD ${costo}\n`+
   `Utilidad total: USD ${utilidad}\n`+
   `% Margen: ${pct}%`
 );
}

/* ---------- iniciar -------- */
window.onload=()=>{
 let sF=document.getElementById("filterCliente");
 let sI=document.getElementById("selectClienteInforme");
 let set=new Set();
 facturas.forEach(f=>{if(!set.has(f.cliente)){set.add(f.cliente);sF.innerHTML+=`<option>${f.cliente}</option>`;sI.innerHTML+=`<option>${f.cliente}</option>`;}});
 renderTabla(facturas);
}
</script>

</body>
</html>
